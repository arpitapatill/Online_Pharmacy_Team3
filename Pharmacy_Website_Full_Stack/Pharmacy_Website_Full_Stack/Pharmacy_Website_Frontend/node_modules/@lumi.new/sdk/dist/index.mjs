var B=Object.defineProperty;var N=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var $=i=>{throw TypeError(i)};var k=(i,e,t)=>e in i?B(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v=(i,e)=>{for(var t in e||(e={}))G.call(e,t)&&k(i,t,e[t]);if(N)for(var t of N(e))J.call(e,t)&&k(i,t,e[t]);return i};var j=(i,e,t)=>e.has(i)||$("Cannot "+t);var s=(i,e,t)=>(j(i,e,"read from private field"),t?t.call(i):e.get(i)),l=(i,e,t)=>e.has(i)?$("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),m=(i,e,t,r)=>(j(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var c=(i,e,t)=>new Promise((r,a)=>{var n=g=>{try{y(t.next(g))}catch(h){a(h)}},p=g=>{try{y(t.throw(g))}catch(h){a(h)}},y=g=>g.done?r(g.value):Promise.resolve(g.value).then(n,p);y((t=t.apply(i,e)).next())});import{v4 as Y}from"uuid";import{ofetch as V}from"ofetch";function o(i,e,t={}){return i.auth.accessToken&&(t.headers=v({Authorization:`Bearer ${i.auth.accessToken}`},t.headers)),V(e,v({baseURL:i.config.apiBaseUrl},t))}function q(){var i,e;return(e=(i=document.querySelector('link[rel="icon"]'))==null?void 0:i.href)!=null?e:null}function K(){var i;return(i=document.title)!=null?i:null}function D(i,e,t=localStorage){let r=t.getItem(i),a=e?JSON.stringify(e):null;a?t.setItem(i,a):t.removeItem(i),window.dispatchEvent(new StorageEvent("storage",{key:i,oldValue:r,newValue:a,storageArea:t}))}function M(i,e=localStorage){let t=e.getItem(i);try{return t?JSON.parse(t):null}catch(r){return null}}var d,S,C=class{constructor(e){l(this,d);l(this,S,`lumi-auth-${Y()}`);m(this,d,e)}get accessToken(){return M("lumi-access-token")}set accessToken(e){D("lumi-access-token",e)}get user(){return M("lumi-user")}set user(e){D("lumi-user",e)}get isAuthenticated(){return!!this.accessToken}signIn(){let r=(window.screen.width-800)/2,a=(window.screen.height-600)/2,n=window.open(s(this,d).config.authOrigin,s(this,S),`width=800,height=600,left=${r},top=${a}`),p;return new Promise((y,g)=>{if(!n)return g(new Error("Open auth window failed"));let h=setInterval(()=>{n.closed&&g(new Error("Auth window closed"))},1e3),U=({data:w,origin:_,source:F})=>{if(!(_!==s(this,d).config.authOrigin||F!==n))switch(w==null?void 0:w.type){case"lumi-ready":{n.postMessage({type:"lumi-init",data:{projectId:s(this,d).config.projectId,icon:q(),title:K()}},s(this,d).config.authOrigin);break}case"lumi-sign-in":{if(w.data.projectId!==s(this,d).config.projectId)break;n.close(),window.focus(),this.accessToken=w.data.accessToken,this.user=w.data.user,y(w.data);break}}};window.addEventListener("message",U),p=()=>{clearInterval(h),window.removeEventListener("message",U)}}).finally(()=>p==null?void 0:p())}signOut(){this.accessToken=null,this.user=null}refreshUser(){return c(this,null,function*(){let e=yield o(s(this,d),"/lm/user/info",{method:"POST"});if(e.code!==200)throw new Error(e.message);return this.user=e.data,e.data})}onAuthChange(e){let t=r=>{(r.key==="lumi-access-token"||r.key==="lumi-user"||r.key===null)&&e({isAuthenticated:this.isAuthenticated,user:this.user})};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}}};d=new WeakMap,S=new WeakMap;var u,I=class{constructor(e,t){l(this,u);m(this,u,e),this.entityName=t}list(){return c(this,arguments,function*({filter:e,sort:t,limit:r,skip:a}={}){if(r){let n=yield o(s(this,u),this.uri("/find"),{method:"POST",body:{filter:e,sort:t,limit:r,skip:a}});if(n.code!==200)throw new Error(n.message);return n.data}else{let n=yield o(s(this,u),this.uri("/list"),{method:"POST",body:{filter:e,sort:t}});if(n.code!==200)throw new Error(n.message);return{total:n.data.length,list:n.data}}})}get(e){return c(this,null,function*(){let t=yield o(s(this,u),this.uri(`/${e}`),{method:"GET"});if(t.code!==200)throw new Error(t.message);return t.data})}create(e){return c(this,null,function*(){let t=yield o(s(this,u),this.uri(),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}createMany(e){return c(this,null,function*(){let t=yield o(s(this,u),this.uri("/batch"),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}update(e,t){return c(this,null,function*(){let r=yield o(s(this,u),this.uri(),{method:"PUT",body:{filter:{_id:e},update:t}});if(r.code!==200)throw new Error(r.message);return r.data})}delete(e){return c(this,null,function*(){let t=yield o(s(this,u),this.uri(`/${e}`),{method:"DELETE"});if(t.code!==200)throw new Error(t.message)})}deleteMany(e){return c(this,null,function*(){let t=yield o(s(this,u),this.uri("/batch-by-ids"),{method:"DELETE",params:{ids:e}});if(t.code!==200)throw new Error(t.message)})}uri(e=""){return`/lm/${s(this,u).config.projectId}/${this.entityName}/documents${e}`}};u=new WeakMap;var T,L=class{constructor(e){l(this,T);return m(this,T,e),new Proxy(this,{get(t,r){return r in t||(t[r]=new I(s(t,T),r)),t[r]}})}};T=new WeakMap;var E=class extends Error{constructor(t,r){super(r);this.name="LumiError";this.code=t}};var b,x=class{constructor(e){l(this,b);m(this,b,e)}send(g){return c(this,arguments,function*({to:e,subject:t,fromName:r,html:a,text:n="",replyTo:p,scheduledAt:y}){if(!e||!t||!a&&!n)throw new Error("Failed to send email: Missing required parameters.");typeof e=="string"&&(e=[e]),typeof p=="string"&&(p=[p]);let h=yield o(s(this,b),`/lm/${s(this,b).config.projectId}/email/send`,{method:"POST",body:{to:e,subject:t,fromName:r,html:a,text:n,replyTo:p,scheduledAt:y}});if(h.code!==200)throw new E(h.code,h.message)})}};b=new WeakMap;var f,A=class{constructor(e){l(this,f);m(this,f,e)}upload(e){return c(this,null,function*(){let t=new FormData;e.forEach(a=>{t.append("files",a)});let r=yield o(s(this,f),`/lm/${s(this,f).config.projectId}/file/batch`,{method:"POST",body:t});if(r.code!==200)throw new E(r.code,r.message);return r.data})}delete(e){return c(this,null,function*(){let t=yield o(s(this,f),`/lm/${s(this,f).config.projectId}/file/batch`,{method:"DELETE",body:{fileUrls:e}});if(t.code!==200)throw new E(t.code,t.message)})}};f=new WeakMap;var P,R=class{constructor(e){l(this,P);m(this,P,e),this.email=new x(e),this.file=new A(e)}};P=new WeakMap;var O=class{constructor(e){this.config=e,this.auth=new C(this),this.entities=new L(this),this.tools=new R(this)}};function Ae(i){return new O(i)}export{x as EmailTool,L as EntitiesClient,I as EntityClient,A as FileTool,C as LumiAuthClient,O as LumiClient,R as ToolsClient,Ae as createClient};
//# sourceMappingURL=index.mjs.map