"use strict";var R=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var q=i=>{throw TypeError(i)};var $=(i,e,t)=>e in i?R(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e)=>{for(var t in e||(e={}))j.call(e,t)&&$(i,t,e[t]);if(k)for(var t of k(e))H.call(e,t)&&$(i,t,e[t]);return i};var Q=(i,e)=>{for(var t in e)R(i,t,{get:e[t],enumerable:!0})},W=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of z(e))!j.call(i,n)&&n!==t&&R(i,n,{get:()=>e[n],enumerable:!(r=Y(e,n))||r.enumerable});return i};var X=i=>W(R({},"__esModule",{value:!0}),i);var K=(i,e,t)=>e.has(i)||q("Cannot "+t);var s=(i,e,t)=>(K(i,e,"read from private field"),t?t.call(i):e.get(i)),l=(i,e,t)=>e.has(i)?q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),m=(i,e,t,r)=>(K(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var c=(i,e,t)=>new Promise((r,n)=>{var o=g=>{try{y(t.next(g))}catch(h){n(h)}},p=g=>{try{y(t.throw(g))}catch(h){n(h)}},y=g=>g.done?r(g.value):Promise.resolve(g.value).then(o,p);y((t=t.apply(i,e)).next())});var ee={};Q(ee,{EmailTool:()=>L,EntitiesClient:()=>S,EntityClient:()=>C,FileTool:()=>x,LumiAuthClient:()=>T,LumiClient:()=>D,ToolsClient:()=>A,createClient:()=>Z});module.exports=X(ee);var G=require("uuid");var _=require("ofetch");function a(i,e,t={}){return i.auth.accessToken&&(t.headers=M({Authorization:`Bearer ${i.auth.accessToken}`},t.headers)),(0,_.ofetch)(e,M({baseURL:i.config.apiBaseUrl},t))}function F(){var i,e;return(e=(i=document.querySelector('link[rel="icon"]'))==null?void 0:i.href)!=null?e:null}function B(){var i;return(i=document.title)!=null?i:null}function O(i,e,t=localStorage){let r=t.getItem(i),n=e?JSON.stringify(e):null;n?t.setItem(i,n):t.removeItem(i),window.dispatchEvent(new StorageEvent("storage",{key:i,oldValue:r,newValue:n,storageArea:t}))}function U(i,e=localStorage){let t=e.getItem(i);try{return t?JSON.parse(t):null}catch(r){return null}}var d,P,T=class{constructor(e){l(this,d);l(this,P,`lumi-auth-${(0,G.v4)()}`);m(this,d,e)}get accessToken(){return U("lumi-access-token")}set accessToken(e){O("lumi-access-token",e)}get user(){return U("lumi-user")}set user(e){O("lumi-user",e)}get isAuthenticated(){return!!this.accessToken}signIn(){let r=(window.screen.width-800)/2,n=(window.screen.height-600)/2,o=window.open(s(this,d).config.authOrigin,s(this,P),`width=800,height=600,left=${r},top=${n}`),p;return new Promise((y,g)=>{if(!o)return g(new Error("Open auth window failed"));let h=setInterval(()=>{o.closed&&g(new Error("Auth window closed"))},1e3),N=({data:w,origin:J,source:V})=>{if(!(J!==s(this,d).config.authOrigin||V!==o))switch(w==null?void 0:w.type){case"lumi-ready":{o.postMessage({type:"lumi-init",data:{projectId:s(this,d).config.projectId,icon:F(),title:B()}},s(this,d).config.authOrigin);break}case"lumi-sign-in":{if(w.data.projectId!==s(this,d).config.projectId)break;o.close(),window.focus(),this.accessToken=w.data.accessToken,this.user=w.data.user,y(w.data);break}}};window.addEventListener("message",N),p=()=>{clearInterval(h),window.removeEventListener("message",N)}}).finally(()=>p==null?void 0:p())}signOut(){this.accessToken=null,this.user=null}refreshUser(){return c(this,null,function*(){let e=yield a(s(this,d),"/lm/user/info",{method:"POST"});if(e.code!==200)throw new Error(e.message);return this.user=e.data,e.data})}onAuthChange(e){let t=r=>{(r.key==="lumi-access-token"||r.key==="lumi-user"||r.key===null)&&e({isAuthenticated:this.isAuthenticated,user:this.user})};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}}};d=new WeakMap,P=new WeakMap;var u,C=class{constructor(e,t){l(this,u);m(this,u,e),this.entityName=t}list(){return c(this,arguments,function*({filter:e,sort:t,limit:r,skip:n}={}){if(r){let o=yield a(s(this,u),this.uri("/find"),{method:"POST",body:{filter:e,sort:t,limit:r,skip:n}});if(o.code!==200)throw new Error(o.message);return o.data}else{let o=yield a(s(this,u),this.uri("/list"),{method:"POST",body:{filter:e,sort:t}});if(o.code!==200)throw new Error(o.message);return{total:o.data.length,list:o.data}}})}get(e){return c(this,null,function*(){let t=yield a(s(this,u),this.uri(`/${e}`),{method:"GET"});if(t.code!==200)throw new Error(t.message);return t.data})}create(e){return c(this,null,function*(){let t=yield a(s(this,u),this.uri(),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}createMany(e){return c(this,null,function*(){let t=yield a(s(this,u),this.uri("/batch"),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}update(e,t){return c(this,null,function*(){let r=yield a(s(this,u),this.uri(),{method:"PUT",body:{filter:{_id:e},update:t}});if(r.code!==200)throw new Error(r.message);return r.data})}delete(e){return c(this,null,function*(){let t=yield a(s(this,u),this.uri(`/${e}`),{method:"DELETE"});if(t.code!==200)throw new Error(t.message)})}deleteMany(e){return c(this,null,function*(){let t=yield a(s(this,u),this.uri("/batch-by-ids"),{method:"DELETE",params:{ids:e}});if(t.code!==200)throw new Error(t.message)})}uri(e=""){return`/lm/${s(this,u).config.projectId}/${this.entityName}/documents${e}`}};u=new WeakMap;var I,S=class{constructor(e){l(this,I);return m(this,I,e),new Proxy(this,{get(t,r){return r in t||(t[r]=new C(s(t,I),r)),t[r]}})}};I=new WeakMap;var E=class extends Error{constructor(t,r){super(r);this.name="LumiError";this.code=t}};var b,L=class{constructor(e){l(this,b);m(this,b,e)}send(g){return c(this,arguments,function*({to:e,subject:t,fromName:r,html:n,text:o="",replyTo:p,scheduledAt:y}){if(!e||!t||!n&&!o)throw new Error("Failed to send email: Missing required parameters.");typeof e=="string"&&(e=[e]),typeof p=="string"&&(p=[p]);let h=yield a(s(this,b),`/lm/${s(this,b).config.projectId}/email/send`,{method:"POST",body:{to:e,subject:t,fromName:r,html:n,text:o,replyTo:p,scheduledAt:y}});if(h.code!==200)throw new E(h.code,h.message)})}};b=new WeakMap;var f,x=class{constructor(e){l(this,f);m(this,f,e)}upload(e){return c(this,null,function*(){let t=new FormData;e.forEach(n=>{t.append("files",n)});let r=yield a(s(this,f),`/lm/${s(this,f).config.projectId}/file/batch`,{method:"POST",body:t});if(r.code!==200)throw new E(r.code,r.message);return r.data})}delete(e){return c(this,null,function*(){let t=yield a(s(this,f),`/lm/${s(this,f).config.projectId}/file/batch`,{method:"DELETE",body:{fileUrls:e}});if(t.code!==200)throw new E(t.code,t.message)})}};f=new WeakMap;var v,A=class{constructor(e){l(this,v);m(this,v,e),this.email=new L(e),this.file=new x(e)}};v=new WeakMap;var D=class{constructor(e){this.config=e,this.auth=new T(this),this.entities=new S(this),this.tools=new A(this)}};function Z(i){return new D(i)}0&&(module.exports={EmailTool,EntitiesClient,EntityClient,FileTool,LumiAuthClient,LumiClient,ToolsClient,createClient});
//# sourceMappingURL=index.js.map